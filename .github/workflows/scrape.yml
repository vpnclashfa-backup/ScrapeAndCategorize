# Ù…Ø³ÛŒØ±: .github/workflows/main.yml

name: Scrape And Categorize V2Ray Configs

on:
  push:
    branches:
      - main  # ÛŒØ§ Ù‡Ø± Ø´Ø§Ø®Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯
  workflow_dispatch: # Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  build-and-commit:
    runs-on: ubuntu-latest

    steps:
      # Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ Ø§Ø² Ù…Ø®Ø²Ù† Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨
      - name: Checkout repository
        uses: actions/checkout@v4

      # Ù…Ø±Ø­Ù„Ù‡ Û²: ØªÙ†Ø¸ÛŒÙ… Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØªÙˆÙ†
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # Ù†Ø³Ø®Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø§ Ø¢Ù† Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯

      # Ù…Ø±Ø­Ù„Ù‡ Û³: Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø² ÙØ§ÛŒÙ„ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Ù…Ø±Ø­Ù„Ù‡ Û´: Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†
      - name: Run the main script
        run: python main.py

      # Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ú©Ø§Ù…ÛŒØª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Ø¬Ø¯ÛŒØ¯
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A .  # Ø§ÙØ²ÙˆØ¯Ù† ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ÛŒØ§ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ (Ø´Ø§Ù…Ù„ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ùˆ Ù„Ø§Ú¯)
          # ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ø§Ù…ÛŒØª Ú©Ù† Ú©Ù‡ ØªØºÛŒÛŒØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
          git diff-index --quiet HEAD || git commit -m "ğŸ“Š Update configs and logs"
          git push
